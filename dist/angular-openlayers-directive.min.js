angular.module("openlayers-directive",["ngSanitize"]).directive("openlayers",function($log,$q,$compile,olHelpers,olMapDefaults,olData){return{restrict:"EA",transclude:!0,replace:!0,scope:{center:"=olCenter",defaults:"=olDefaults",view:"=olView",events:"=olEvents",drawInteraction:"=olDrawInteraction",getDrawCollection:"=olGetDrawCollection"},template:'<div class="angular-openlayers-map" ng-transclude></div>',controller:function($scope){var _map=$q.defer();$scope.getMap=function(){return _map.promise},$scope.setMap=function(map){_map.resolve(map)},this.getOpenlayersScope=function(){return $scope}},link:function(scope,element,attrs){var lastDrawInteraction,isDefined=olHelpers.isDefined,createLayer=olHelpers.createLayer,setMapEvents=olHelpers.setMapEvents,setViewEvents=olHelpers.setViewEvents,createView=olHelpers.createView,defaults=olMapDefaults.setDefaults(scope);isDefined(attrs.width)&&(isNaN(attrs.width)?element.css("width",attrs.width):element.css("width",attrs.width+"px")),isDefined(attrs.height)&&(isNaN(attrs.height)?element.css("height",attrs.height):element.css("height",attrs.height+"px")),isDefined(attrs.lat)&&(defaults.center.lat=parseFloat(attrs.lat)),isDefined(attrs.lon)&&(defaults.center.lon=parseFloat(attrs.lon)),isDefined(attrs.zoom)&&(defaults.center.zoom=parseFloat(attrs.zoom));var controls=ol.control.defaults(defaults.controls),interactions=ol.interaction.defaults(defaults.interactions),view=createView(defaults.view),map=new ol.Map({target:element[0],controls:controls,interactions:interactions,renderer:defaults.renderer,view:view});if(scope.$on("$destroy",function(){olData.resetMap(attrs.id)}),!attrs.customLayers){var l={type:"Tile",source:{type:"OSM"}},layer=createLayer(l,view.getProjection(),"default");map.addLayer(layer),map.set("default",!0)}if(!isDefined(attrs.olCenter)){var c=ol.proj.transform([defaults.center.lon,defaults.center.lat],defaults.center.projection,view.getProjection());view.setCenter(c),view.setZoom(defaults.center.zoom)}setMapEvents(defaults.events,map,scope),setViewEvents(defaults.events,map,scope);var drawFeatures=new ol.Collection,drawVectorLayer=new ol.layer.Vector({source:new ol.source.Vector({features:drawFeatures}),style:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"#ffcc33",width:2}),image:new ol.style.Circle({radius:7,fill:new ol.style.Fill({color:"#ffcc33"})})})});map.addLayer(drawVectorLayer);var modify=new ol.interaction.Modify({features:drawFeatures,deleteCondition:function(event){return ol.events.condition.shiftKeyOnly(event)&&ol.events.condition.singleClick(event)}});map.addInteraction(modify),scope.$watch("drawInteraction",function(interaction){if(angular.isUndefined(interaction)||null==interaction)return void(lastDrawInteraction&&map.removeInteraction(lastDrawInteraction));map.removeInteraction(lastDrawInteraction);var newDrawInteraction=new ol.interaction.Draw({features:drawFeatures,type:interaction});lastDrawInteraction=newDrawInteraction,map.addInteraction(newDrawInteraction)}),attrs.hasOwnProperty("olGetDrawCollection")&&(scope.getDrawCollection=function(){return drawFeatures}),scope.setMap(map),olData.setMap(map,attrs.id)}}}),angular.module("openlayers-directive").directive("olCenter",function($log,$location,olMapDefaults,olHelpers){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(scope,element,attrs,controller){var safeApply=olHelpers.safeApply,isValidCenter=olHelpers.isValidCenter,isDefined=olHelpers.isDefined,isArray=olHelpers.isArray,isNumber=olHelpers.isNumber,isSameCenterOnMap=olHelpers.isSameCenterOnMap,setCenter=olHelpers.setCenter,setZoom=olHelpers.setZoom,olScope=controller.getOpenlayersScope();olScope.getMap().then(function(map){var defaults=olMapDefaults.getDefaults(olScope),view=map.getView(),center=olScope.center;if(-1!==attrs.olCenter.search("-"))return $log.error('[AngularJS - Openlayers] The "center" variable can\'t use a "-" on his key name: "'+attrs.center+'".'),void setCenter(view,defaults.view.projection,defaults.center,map);isDefined(center)||(center={}),isValidCenter(center)||($log.warn("[AngularJS - Openlayers] invalid 'center'"),center.lat=defaults.center.lat,center.lon=defaults.center.lon,center.zoom=defaults.center.zoom,center.projection=defaults.center.projection),center.projection||("pixel"!==defaults.view.projection?center.projection=defaults.center.projection:center.projection="pixel"),isNumber(center.zoom)||(center.zoom=1),setCenter(view,defaults.view.projection,center,map),view.setZoom(center.zoom);var centerUrlHash;if(center.centerUrlHash===!0){var extractCenterFromUrl=function(){var centerParam,search=$location.search();if(isDefined(search.c)){var cParam=search.c.split(":");3===cParam.length&&(centerParam={lat:parseFloat(cParam[0]),lon:parseFloat(cParam[1]),zoom:parseInt(cParam[2],10)})}return centerParam};centerUrlHash=extractCenterFromUrl(),olScope.$on("$locationChangeSuccess",function(){var urlCenter=extractCenterFromUrl();urlCenter&&!isSameCenterOnMap(urlCenter,map)&&safeApply(olScope,function(scope){scope.center.lat=urlCenter.lat,scope.center.lon=urlCenter.lon,scope.center.zoom=urlCenter.zoom})})}var geolocation;olScope.$watchCollection("center",function(center){if(center){if(center.projection||(center.projection=defaults.center.projection),center.autodiscover)return geolocation||(geolocation=new ol.Geolocation({projection:ol.proj.get(center.projection)}),geolocation.on("change",function(){if(center.autodiscover){var location=geolocation.getPosition();safeApply(olScope,function(scope){scope.center.lat=location[1],scope.center.lon=location[0],scope.center.zoom=12,scope.center.autodiscover=!1,geolocation.setTracking(!1)})}})),void geolocation.setTracking(!0);isValidCenter(center)||($log.warn("[AngularJS - Openlayers] invalid 'center'"),center=defaults.center);var viewCenter=view.getCenter();if(viewCenter){if("pixel"===defaults.view.projection)return void view.setCenter(center.coord);var actualCenter=ol.proj.transform(viewCenter,defaults.view.projection,center.projection);actualCenter[1]===center.lat&&actualCenter[0]===center.lon||setCenter(view,defaults.view.projection,center,map)}view.getZoom()!==center.zoom&&setZoom(view,center.zoom,map)}}),map.on("moveend",function(){safeApply(olScope,function(scope){if(isDefined(scope.center)){var center=map.getView().getCenter();if(scope.center.zoom=view.getZoom(),"pixel"===defaults.view.projection)return void(scope.center.coord=center);if(scope.center){var proj=ol.proj.transform(center,defaults.view.projection,scope.center.projection);if(scope.center.lat=proj[1],scope.center.lon=proj[0],olHelpers.notifyCenterUrlHashChanged(olScope,scope.center,$location.search()),isArray(scope.center.bounds)){var extent=view.calculateExtent(map.getSize()),centerProjection=scope.center.projection,viewProjection=defaults.view.projection;scope.center.bounds=ol.proj.transformExtent(extent,viewProjection,centerProjection)}}}})})})}}}),angular.module("openlayers-directive").directive("olLayer",function($log,$q,olMapDefaults,olHelpers){return{restrict:"E",scope:{properties:"=olLayerProperties"},replace:!1,require:"^openlayers",link:function(scope,element,attrs,controller){var isDefined=olHelpers.isDefined,equals=olHelpers.equals,olScope=controller.getOpenlayersScope(),createLayer=olHelpers.createLayer,setVectorLayerEvents=olHelpers.setVectorLayerEvents,detectLayerType=olHelpers.detectLayerType,createStyle=olHelpers.createStyle,isBoolean=olHelpers.isBoolean,addLayerBeforeMarkers=olHelpers.addLayerBeforeMarkers,isNumber=olHelpers.isNumber,insertLayer=olHelpers.insertLayer,removeLayer=olHelpers.removeLayer,addLayerToGroup=olHelpers.addLayerToGroup,removeLayerFromGroup=olHelpers.removeLayerFromGroup,getGroup=olHelpers.getGroup;olScope.getMap().then(function(map){var olLayer,projection=map.getView().getProjection(),defaults=olMapDefaults.setDefaults(olScope),layerCollection=map.getLayers();if(scope.$on("$destroy",function(){scope.properties.group?removeLayerFromGroup(layerCollection,olLayer,scope.properties.group):removeLayer(layerCollection,olLayer.index),map.removeLayer(olLayer)}),isDefined(scope.properties))scope.$watch("properties",function(properties,oldProperties){if(isDefined(properties.source)&&isDefined(properties.source.type)){if(!isDefined(properties.visible))return void(properties.visible=!0);if(!isDefined(properties.opacity))return void(properties.opacity=1);var style,group,collection;if(isDefined(olLayer)){var isNewLayer=function(olLayer){return function(layer){return layer!==olLayer}}(olLayer);if(isDefined(oldProperties)&&!equals(properties.source,oldProperties.source)){var idx=olLayer.index;collection=layerCollection,group=olLayer.get("group"),group&&(collection=getGroup(layerCollection,group).getLayers()),collection.removeAt(idx),olLayer=createLayer(properties,projection),olLayer.set("group",group),isDefined(olLayer)&&(insertLayer(collection,idx,olLayer),"Vector"===detectLayerType(properties)&&setVectorLayerEvents(defaults.events,map,scope,properties.name))}(isDefined(oldProperties)&&properties.opacity!==oldProperties.opacity||isNewLayer(olLayer))&&(isNumber(properties.opacity)||isNumber(parseFloat(properties.opacity)))&&olLayer.setOpacity(properties.opacity),isDefined(properties.index)&&properties.index!==olLayer.index&&(collection=layerCollection,group=olLayer.get("group"),group&&(collection=getGroup(layerCollection,group).getLayers()),removeLayer(collection,olLayer.index),insertLayer(collection,properties.index,olLayer)),isDefined(properties.group)&&properties.group!==oldProperties.group&&(removeLayerFromGroup(layerCollection,olLayer,oldProperties.group),addLayerToGroup(layerCollection,olLayer,properties.group)),(isDefined(oldProperties)&&isBoolean(properties.visible)&&properties.visible!==oldProperties.visible||isNewLayer(olLayer))&&olLayer.setVisible(properties.visible),(isDefined(properties.style)&&!equals(properties.style,oldProperties.style)||isNewLayer(olLayer))&&(style=angular.isFunction(properties.style)?properties.style:createStyle(properties.style),olLayer.setStyle&&angular.isFunction(olLayer.setStyle)&&olLayer.setStyle(style)),equals(properties.minResolution,oldProperties.minResolution)&&!isNewLayer(olLayer)||isDefined(properties.minResolution)&&olLayer.setMinResolution(properties.minResolution),equals(properties.maxResolution,oldProperties.maxResolution)&&!isNewLayer(olLayer)||isDefined(properties.maxResolution)&&olLayer.setMaxResolution(properties.maxResolution)}else olLayer=createLayer(properties,projection),isDefined(properties.group)?addLayerToGroup(layerCollection,olLayer,properties.group):isDefined(properties.index)?insertLayer(layerCollection,properties.index,olLayer):addLayerBeforeMarkers(layerCollection,olLayer),"Vector"===detectLayerType(properties)&&setVectorLayerEvents(defaults.events,map,scope,properties.name),isBoolean(properties.visible)&&olLayer.setVisible(properties.visible),properties.opacity&&olLayer.setOpacity(properties.opacity),angular.isArray(properties.extent)&&olLayer.setExtent(properties.extent),properties.style&&(style=angular.isFunction(properties.style)?properties.style:createStyle(properties.style),olLayer.setStyle&&angular.isFunction(olLayer.setStyle)&&olLayer.setStyle(style)),properties.minResolution&&olLayer.setMinResolution(properties.minResolution),properties.maxResolution&&olLayer.setMaxResolution(properties.maxResolution)}},!0);else if(isDefined(attrs.sourceType)&&isDefined(attrs.sourceUrl)){var l={source:{url:attrs.sourceUrl,type:attrs.sourceType}};olLayer=createLayer(l,projection,attrs.layerName),"Vector"===detectLayerType(l)&&setVectorLayerEvents(defaults.events,map,scope,attrs.name),addLayerBeforeMarkers(layerCollection,olLayer)}})}}}),angular.module("openlayers-directive").directive("olPath",function($log,$q,olMapDefaults,olHelpers){return{restrict:"E",scope:{properties:"=olGeomProperties",showMessageOnMouseOver:"=showMessageOnMouseOver",showMessage:"=showMessage"},require:"^openlayers",replace:!0,template:'<div class="popup-label path" ng-bind-html="message"></div>',link:function(scope,element,attrs,controller){var label,isDefined=olHelpers.isDefined,createFeature=olHelpers.createFeature,createOverlay=olHelpers.createOverlay,createVectorLayer=olHelpers.createVectorLayer,insertLayer=olHelpers.insertLayer,removeLayer=olHelpers.removeLayer,olScope=controller.getOpenlayersScope();scope.attrs=attrs,olScope.getMap().then(function(map){var mapDefaults=olMapDefaults.getDefaults(olScope),viewProjection=mapDefaults.view.projection,layer=createVectorLayer(),layerCollection=map.getLayers();if(insertLayer(layerCollection,layerCollection.getLength(),layer),scope.$on("$destroy",function(){removeLayer(layerCollection,layer.index)}),isDefined(attrs.coords)&&isDefined(attrs.olType)){var proj=attrs.proj||"EPSG:4326",coords=JSON.parse(attrs.coords),type=attrs.olType,data={type:type,coords:coords,projection:proj,style:mapDefaults.styles.path},feature=createFeature(data,viewProjection);if(layer.getSource().addFeature(feature),handleInteraction=function(evt){var found=!1,pixel=map.getEventPixel(evt),detectedFeature=map.forEachFeatureAtPixel(pixel,function(feature){return feature}),actionTaken=!1;if(detectedFeature===feature&&scope.message){actionTaken=!0,found=!0;var extent=detectedFeature.getGeometry().getExtent();label=createOverlay(element,extent),map.addOverlay(label),map.getTarget().style.cursor="pointer"}!found&&label&&(actionTaken=!0,map.removeOverlay(label),map.getTarget().style.cursor=""),actionTaken&&evt.preventDefault()},attrs.hasOwnProperty("message")){scope.$watch("attrs.message",function(newMessage,oldMessage){scope.message=newMessage,oldMessage||scope.showMessage&&map.addOverlay(label),newMessage||scope.showMessage&&map.removeOverlay(label)});var extent=feature.getGeometry().getExtent();label=createOverlay(element,extent),attrs.hasOwnProperty("showMessage")&&scope.$watch("showMessage",function(show){scope.message&&(show?(map.getViewport().removeEventListener("mousemove",handleInteraction),map.addOverlay(label)):(scope.showOnMouseOver&&map.getViewport().addEventListener("mousemove",handleInteraction),map.removeOverlay(label)))}),attrs.hasOwnProperty("showMessageOnMouseOver")&&scope.$watch("showMessageOnMouseOver",function(hover){hover&&!scope.show?(map.getViewport().removeEventListener("mousemove",handleInteraction),map.getViewport().addEventListener("mousemove",handleInteraction)):map.getViewport().removeEventListener("mousemove",handleInteraction)})}}else;})}}}),angular.module("openlayers-directive").directive("olView",function($log,$q,olData,olMapDefaults,olHelpers){return{restrict:"A",scope:!1,replace:!1,require:"openlayers",link:function(scope,element,attrs,controller){var olScope=controller.getOpenlayersScope(),isNumber=olHelpers.isNumber,safeApply=olHelpers.safeApply,createView=olHelpers.createView;olScope.getMap().then(function(map){var defaults=olMapDefaults.getDefaults(olScope),view=olScope.view;view.projection||(view.projection=defaults.view.projection),view.maxZoom||(view.maxZoom=defaults.view.maxZoom),view.minZoom||(view.minZoom=defaults.view.minZoom),view.rotation||(view.rotation=defaults.view.rotation);var mapView=createView(view);map.setView(mapView),olScope.$watchCollection("view",function(view){isNumber(view.rotation)&&mapView.setRotation(view.rotation)}),mapView.on("change:rotation",function(){safeApply(olScope,function(scope){scope.view.rotation=map.getView().getRotation()})})})}}}),angular.module("openlayers-directive").directive("olControl",function($log,$q,olData,olMapDefaults,olHelpers){return{restrict:"E",scope:{properties:"=olControlProperties"},replace:!1,require:"^openlayers",link:function(scope,element,attrs,controller){var olControl,olControlOps,isDefined=olHelpers.isDefined,olScope=controller.getOpenlayersScope();olScope.getMap().then(function(map){var getControlClasses=olHelpers.getControlClasses,controlClasses=getControlClasses();return scope.$on("$destroy",function(){map.removeControl(olControl)}),isDefined(scope.properties)&&isDefined(scope.properties.control)?(olControl=scope.properties.control,void map.addControl(olControl)):void(attrs.name&&(isDefined(scope.properties)&&(olControlOps=scope.properties),olControl=new controlClasses[attrs.name](olControlOps),map.addControl(olControl)))})}}}),angular.module("openlayers-directive").directive("olMarker",function($log,$q,olMapDefaults,olHelpers){var getMarkerDefaults=function(){return{projection:"EPSG:4326",lat:0,lon:0,coord:[],show:!0,showOnMouseOver:!1,showOnMouseClick:!1,keepOneOverlayVisible:!1}},markerLayerManager=function(){function getMapIndex(map){return mapDict.map(function(record){return record.map}).indexOf(map)}var mapDict=[];return{getInst:function(scope,map){var mapIndex=getMapIndex(map);if(-1===mapIndex){var markerLayer=olHelpers.createVectorLayer();markerLayer.set("markers",!0),map.addLayer(markerLayer),mapDict.push({map:map,markerLayer:markerLayer,instScopes:[]}),mapIndex=mapDict.length-1}return mapDict[mapIndex].instScopes.push(scope),mapDict[mapIndex].markerLayer},deregisterScope:function(scope,map){var mapIndex=getMapIndex(map);if(-1===mapIndex)throw Error("This map has no markers");var scopes=mapDict[mapIndex].instScopes,scopeIndex=scopes.indexOf(scope);if(-1===scopeIndex)throw Error("Scope wan't registered");scopes.splice(scopeIndex,1),scopes.length||(map.removeLayer(mapDict[mapIndex].markerLayer),delete mapDict[mapIndex])}}}();return{restrict:"E",scope:{lat:"=lat",lon:"=lon",label:"=label",properties:"=olMarkerProperties",style:"=olStyle"},transclude:!0,require:"^openlayers",replace:!0,template:'<div class="popup-label marker"><div ng-bind-html="message"></div><ng-transclude></ng-transclude></div>',link:function(scope,element,attrs,controller){var isDefined=olHelpers.isDefined,olScope=controller.getOpenlayersScope(),createFeature=olHelpers.createFeature,createOverlay=olHelpers.createOverlay,hasTranscluded=element.find("ng-transclude").children().length>0;olScope.getMap().then(function(map){function handleDrag(evt){var coord=evt.coordinate,proj=map.getView().getProjection().getCode();if(coord="pixel"===proj?coord.map(function(v){return parseInt(v,10)}):ol.proj.transform(coord,proj,"EPSG:4326"),"pointerdown"===evt.type){var feature=map.forEachFeatureAtPixel(evt.pixel,function(feature){return feature});if(pickProperties=feature?feature.get("marker"):null,!pickProperties||!pickProperties.draggable)return void(pickProperties=null);map.getTarget().style.cursor="pointer",pickOffset="pixel"===proj?[coord[0]-pickProperties.coord[0],coord[1]-pickProperties.coord[1]]:[coord[0]-pickProperties.lon,coord[1]-pickProperties.lat],evt.preventDefault()}else pickOffset&&pickProperties&&("pointerup"===evt.type?(map.getTarget().style.cursor="",pickOffset=null,pickProperties=null,evt.preventDefault()):"pointerdrag"===evt.type&&(evt.preventDefault(),scope.$apply(function(){"pixel"===proj?(pickProperties.coord[0]=coord[0]-pickOffset[0],pickProperties.coord[1]=coord[1]-pickOffset[1]):(pickProperties.lon=coord[0]-pickOffset[0],pickProperties.lat=coord[1]-pickOffset[1])})))}var label,pos,marker,markerLayer=markerLayerManager.getInst(scope,map),data=getMarkerDefaults(),mapDefaults=olMapDefaults.getDefaults(olScope),viewProjection=mapDefaults.view.projection,pickOffset=null,pickProperties=null;return map.on("pointerdown",handleDrag),map.on("pointerup",handleDrag),map.on("pointerdrag",handleDrag),scope.$on("$destroy",function(){markerLayer.getSource().removeFeature(marker),isDefined(label)&&map.removeOverlay(label),markerLayerManager.deregisterScope(scope,map)}),isDefined(scope.properties)?void scope.$watch("properties",function(properties){if(map.getViewport().removeEventListener("mousemove",properties.handleInteraction),map.getViewport().removeEventListener("click",properties.handleTapInteraction),map.getViewport().querySelector("canvas.ol-unselectable").removeEventListener("touchend",properties.handleTapInteraction),map.getViewport().removeEventListener("mousemove",properties.showAtLeastOneOverlay),map.getViewport().removeEventListener("click",properties.removeAllOverlays),properties.handleInteraction=function(evt){if(!properties.label.show){var found=!1,pixel=map.getEventPixel(evt),feature=map.forEachFeatureAtPixel(pixel,function(feature){return feature}),actionTaken=!1;feature===marker&&(actionTaken=!0,found=!0,isDefined(label)||(pos="pixel"===data.projection?properties.coord:ol.proj.transform([properties.lon,properties.lat],data.projection,viewProjection),label=createOverlay(element,pos),map.addOverlay(label)),!properties.onClick||"click"!==evt.type&&"touchend"!==evt.type||scope.$apply(function(){properties.onClick.call(marker,evt,properties)}),map.getTarget().style.cursor="pointer"),!found&&label&&(actionTaken=!0,map.removeOverlay(label),label=void 0,map.getTarget().style.cursor=""),actionTaken&&evt.preventDefault()}},properties.handleTapInteraction=function(){function activateCooldown(){cooldownActive=!0,prevTimeout&&clearTimeout(prevTimeout),prevTimeout=setTimeout(function(){cooldownActive=!1,prevTimeout=null},500)}var prevTimeout,cooldownActive=!1;return map.getViewport().querySelector("canvas.ol-unselectable").addEventListener("touchmove",activateCooldown),function(){cooldownActive||(properties.handleInteraction.apply(null,arguments),activateCooldown())}}(),properties.showAtLeastOneOverlay=function(evt){if(!properties.label.show){var found=!1,pixel=map.getEventPixel(evt),feature=map.forEachFeatureAtPixel(pixel,function(feature){return feature}),actionTaken=!1;feature===marker&&(actionTaken=!0,found=!0,isDefined(label)||(pos="pixel"===data.projection?data.coord:ol.proj.transform([data.lon,data.lat],data.projection,viewProjection),label=createOverlay(element,pos),angular.forEach(map.getOverlays(),function(value){map.removeOverlay(value)}),map.addOverlay(label)),map.getTarget().style.cursor="pointer"),!found&&label&&(actionTaken=!0,label=void 0,map.getTarget().style.cursor=""),actionTaken&&evt.preventDefault()}},properties.removeAllOverlays=function(evt){angular.forEach(map.getOverlays(),function(value){map.removeOverlay(value)}),evt.preventDefault()},isDefined(marker)){var requestedPosition;if(requestedPosition="pixel"===properties.projection?properties.coord:ol.proj.transform([properties.lon,properties.lat],data.projection,map.getView().getProjection()),!angular.equals(marker.getGeometry().getCoordinates(),requestedPosition)){var geometry=new ol.geom.Point(requestedPosition);marker.setGeometry(geometry)}}else data.projection=properties.projection?properties.projection:data.projection,data.coord=properties.coord?properties.coord:data.coord,data.lat=properties.lat?properties.lat:data.lat,data.lon=properties.lon?properties.lon:data.lon,isDefined(properties.style)?data.style=properties.style:data.style=mapDefaults.styles.marker,marker=createFeature(data,viewProjection),isDefined(marker)||$log.error("[AngularJS - Openlayers] Received invalid data on the marker."),marker.set("marker",properties),markerLayer.getSource().addFeature(marker);isDefined(label)&&map.removeOverlay(label),isDefined(properties.label)&&(scope.message=properties.label.message,(hasTranscluded||isDefined(scope.message)&&0!==scope.message.length)&&(properties.label&&properties.label.show===!0&&(pos="pixel"===data.projection?data.coord:ol.proj.transform([properties.lon,properties.lat],data.projection,viewProjection),label=createOverlay(element,pos),map.addOverlay(label)),label&&properties.label&&properties.label.show===!1&&(map.removeOverlay(label),label=void 0),properties.label&&properties.label.show===!1&&properties.label.showOnMouseOver&&map.getViewport().addEventListener("mousemove",properties.handleInteraction),(properties.label&&properties.label.show===!1&&properties.label.showOnMouseClick||properties.onClick)&&(map.getViewport().addEventListener("click",properties.handleTapInteraction),map.getViewport().querySelector("canvas.ol-unselectable").addEventListener("touchend",properties.handleTapInteraction)),properties.label&&properties.label.show===!1&&properties.label.keepOneOverlayVisible&&(map.getViewport().addEventListener("mousemove",properties.showAtLeastOneOverlay),map.getViewport().addEventListener("click",properties.removeAllOverlays))))},!0):(data.lat=scope.lat?scope.lat:data.lat,data.lon=scope.lon?scope.lon:data.lon,data.message=attrs.message,data.style=scope.style?scope.style:mapDefaults.styles.marker,marker=createFeature(data,viewProjection),isDefined(marker)||$log.error("[AngularJS - Openlayers] Received invalid data on the marker."),marker.set("marker",scope),markerLayer.getSource().addFeature(marker),void((data.message||hasTranscluded)&&(scope.message=attrs.message,pos=ol.proj.transform([data.lon,data.lat],data.projection,viewProjection),label=createOverlay(element,pos),map.addOverlay(label))))})}}}),angular.module("openlayers-directive").service("olData",function($log,$q){function obtainEffectiveMapId(d,mapId){var id,i;if(angular.isDefined(mapId))id=mapId;else if(1===Object.keys(d).length)for(i in d)d.hasOwnProperty(i)&&(id=i);else 0===Object.keys(d).length?id="main":$log.error("[AngularJS - Openlayers] - You have more than 1 map on the DOM, you must provide the map ID to the olData.getXXX call");return id}var maps={},setResolvedDefer=function(d,mapId){var id=obtainEffectiveMapId(d,mapId);d[id].resolvedDefer=!0},getUnresolvedDefer=function(d,mapId){var defer,id=obtainEffectiveMapId(d,mapId);return angular.isDefined(d[id])&&d[id].resolvedDefer!==!0?defer=d[id].defer:(defer=$q.defer(),d[id]={defer:defer,resolvedDefer:!1}),defer},getDefer=function(d,mapId){var defer,id=obtainEffectiveMapId(d,mapId);return defer=angular.isDefined(d[id])&&d[id].resolvedDefer!==!1?d[id].defer:getUnresolvedDefer(d,mapId)};this.setMap=function(olMap,scopeId){var defer=getUnresolvedDefer(maps,scopeId);defer.resolve(olMap),setResolvedDefer(maps,scopeId)},this.getMap=function(scopeId){var defer=getDefer(maps,scopeId);return defer.promise},this.resetMap=function(scopeId){angular.isDefined(maps[scopeId])&&delete maps[scopeId]}}),angular.module("openlayers-directive").factory("olHelpers",function($q,$log,$http){var isDefined=function(value){return angular.isDefined(value)},isDefinedAndNotNull=function(value){return angular.isDefined(value)&&null!==value},setEvent=function(map,eventType,scope){map.on(eventType,function(event){var coord=event.coordinate,proj=map.getView().getProjection().getCode();"pixel"===proj&&(coord=coord.map(function(v){return parseInt(v,10)})),scope.$emit("openlayers.map."+eventType,{coord:coord,projection:proj,event:event})})},bingImagerySets=["Road","Aerial","AerialWithLabels","collinsBart","ordnanceSurvey"],getControlClasses=function(){return{attribution:ol.control.Attribution,fullscreen:ol.control.FullScreen,mouseposition:ol.control.MousePosition,overviewmap:ol.control.OverviewMap,rotate:ol.control.Rotate,scaleline:ol.control.ScaleLine,zoom:ol.control.Zoom,zoomslider:ol.control.ZoomSlider,zoomtoextent:ol.control.ZoomToExtent}},mapQuestLayers=["osm","sat","hyb"],esriBaseLayers=["World_Imagery","World_Street_Map","World_Topo_Map","World_Physical_Map","World_Terrain_Base","Ocean_Basemap","NatGeo_World_Map"],styleMap={style:ol.style.Style,fill:ol.style.Fill,stroke:ol.style.Stroke,circle:ol.style.Circle,icon:ol.style.Icon,image:ol.style.Image,regularshape:ol.style.RegularShape,text:ol.style.Text},optionalFactory=function(style,Constructor){return Constructor&&style instanceof Constructor?style:Constructor?new Constructor(style):style},createStyle=function recursiveStyle(data,styleName){var style;if(styleName?style=data[styleName]:(styleName="style",style=data),"style"===styleName&&data instanceof Function)return data;if(!(style instanceof Object))return style;var styleObject;if("[object Object]"===Object.prototype.toString.call(style)){styleObject={};var styleConstructor=styleMap[styleName];if(styleConstructor&&style instanceof styleConstructor)return style;Object.getOwnPropertyNames(style).forEach(function(val,idx,array){var valConstructor=styleMap[val];return styleConstructor&&valConstructor&&valConstructor.prototype instanceof styleMap[styleName]?(console.assert(1===array.length,"Extra parameters for "+styleName),styleObject=recursiveStyle(style,val),optionalFactory(styleObject,valConstructor)):(styleObject[val]=recursiveStyle(style,val),void("text"!==val&&"string"!=typeof styleObject[val]&&(styleObject[val]=optionalFactory(styleObject[val],styleMap[val]))))})}else styleObject=style;return optionalFactory(styleObject,styleMap[styleName])},detectLayerType=function(layer){if(layer.type)return layer.type;switch(layer.source.type){case"ImageWMS":return"Image";case"ImageStatic":return"Image";case"GeoJSON":case"JSONP":case"TopoJSON":case"KML":case"TileVector":return"Vector";default:return"Tile"}},createProjection=function(view){var oProjection;switch(view.projection){case"pixel":if(!isDefined(view.extent))return void $log.error("[AngularJS - Openlayers] - You must provide the extent of the image if using pixel projection");oProjection=new ol.proj.Projection({code:"pixel",units:"pixels",extent:view.extent});break;default:oProjection=new ol.proj.get(view.projection)}return oProjection},isValidStamenLayer=function(layer){return-1!==["watercolor","terrain","toner"].indexOf(layer)},createSource=function(source,projection){var oSource,geojsonFormat=new ol.format.GeoJSON;switch(source.type){case"MapBox":if(!source.mapId||!source.accessToken)return void $log.error("[AngularJS - Openlayers] - MapBox layer requires the map id and the access token");var url="http://api.tiles.mapbox.com/v4/"+source.mapId+"/{z}/{x}/{y}.png?access_token="+source.accessToken,pixelRatio=window.devicePixelRatio;pixelRatio>1&&(url=url.replace(".png","@2x.png")),oSource=new ol.source.XYZ({url:url,attributions:createAttribution(source),tilePixelRatio:pixelRatio>1?2:1});break;case"ImageWMS":source.url&&source.params||$log.error("[AngularJS - Openlayers] - ImageWMS Layer needs valid server url and params properties"),oSource=new ol.source.ImageWMS({url:source.url,attributions:createAttribution(source),crossOrigin:"undefined"==typeof source.crossOrigin?"anonymous":source.crossOrigin,params:source.params,ratio:source.ratio});break;case"TileWMS":(source.url||source.urls)&&source.params||$log.error("[AngularJS - Openlayers] - TileWMS Layer needs valid url (or urls) and params properties");var wmsConfiguration={crossOrigin:"undefined"==typeof source.crossOrigin?"anonymous":source.crossOrigin,params:source.params,attributions:createAttribution(source)};source.serverType&&(wmsConfiguration.serverType=source.serverType),source.url&&(wmsConfiguration.url=source.url),source.urls&&(wmsConfiguration.urls=source.urls),oSource=new ol.source.TileWMS(wmsConfiguration);break;case"WMTS":(source.url||source.urls)&&source.tileGrid||$log.error("[AngularJS - Openlayers] - WMTS Layer needs valid url (or urls) and tileGrid properties");var wmtsConfiguration={projection:projection,layer:source.layer,attributions:createAttribution(source),matrixSet:"undefined"===source.matrixSet?projection:source.matrixSet,format:"undefined"===source.format?"image/jpeg":source.format,requestEncoding:"undefined"===source.requestEncoding?"KVP":source.requestEncoding,tileGrid:new ol.tilegrid.WMTS({origin:source.tileGrid.origin,resolutions:source.tileGrid.resolutions,matrixIds:source.tileGrid.matrixIds})};isDefined(source.url)&&(wmtsConfiguration.url=source.url),isDefined(source.urls)&&(wmtsConfiguration.urls=source.urls),oSource=new ol.source.WMTS(wmtsConfiguration);break;case"OSM":oSource=new ol.source.OSM({attributions:createAttribution(source)}),source.url&&oSource.setUrl(source.url);break;case"BingMaps":if(!source.key)return void $log.error("[AngularJS - Openlayers] - You need an API key to show the Bing Maps.");var bingConfiguration={key:source.key,attributions:createAttribution(source),imagerySet:source.imagerySet?source.imagerySet:bingImagerySets[0],culture:source.culture};source.maxZoom&&(bingConfiguration.maxZoom=source.maxZoom),oSource=new ol.source.BingMaps(bingConfiguration);
break;case"MapQuest":if(!source.layer||-1===mapQuestLayers.indexOf(source.layer))return void $log.error("[AngularJS - Openlayers] - MapQuest layers needs a valid 'layer' property.");oSource=new ol.source.MapQuest({attributions:createAttribution(source),layer:source.layer});break;case"EsriBaseMaps":if(!source.layer||-1===esriBaseLayers.indexOf(source.layer))return void $log.error("[AngularJS - Openlayers] - ESRI layers needs a valid 'layer' property.");var _urlBase="http://services.arcgisonline.com/ArcGIS/rest/services/",_url=_urlBase+source.layer+"/MapServer/tile/{z}/{y}/{x}";oSource=new ol.source.XYZ({attributions:createAttribution(source),url:_url});break;case"GeoJSON":if(!source.geojson&&!source.url)return void $log.error("[AngularJS - Openlayers] - You need a geojson property to add a GeoJSON layer.");if(isDefined(source.url))oSource=new ol.source.Vector({format:new ol.format.GeoJSON,url:source.url});else{oSource=new ol.source.Vector;var projectionToUse=projection;isDefined(source.geojson.projection)&&(projectionToUse=source.geojson.projection);var features=geojsonFormat.readFeatures(source.geojson.object,{featureProjection:projectionToUse,dataProjection:projectionToUse});oSource.addFeatures(features)}break;case"JSONP":if(!source.url)return void $log.error("[AngularJS - Openlayers] - You need an url properly configured to add a JSONP layer.");isDefined(source.url)&&(oSource=new ol.source.ServerVector({format:geojsonFormat,loader:function(){var url=source.url+"&outputFormat=text/javascript&format_options=callback:JSON_CALLBACK";$http.jsonp(url,{cache:source.cache}).success(function(response){oSource.addFeatures(geojsonFormat.readFeatures(response))}).error(function(response){$log(response)})},projection:projection}));break;case"TopoJSON":if(!source.topojson&&!source.url)return void $log.error("[AngularJS - Openlayers] - You need a topojson property to add a TopoJSON layer.");oSource=source.url?new ol.source.Vector({format:new ol.format.TopoJSON,url:source.url}):new ol.source.Vector(angular.extend(source.topojson,{format:new ol.format.TopoJSON}));break;case"TileJSON":oSource=new ol.source.TileJSON({url:source.url,attributions:createAttribution(source),crossOrigin:"anonymous"});break;case"TileVector":source.url&&source.format||$log.error("[AngularJS - Openlayers] - TileVector Layer needs valid url and format properties"),oSource=new ol.source.TileVector({url:source.url,projection:projection,attributions:createAttribution(source),format:source.format,tileGrid:new ol.tilegrid.createXYZ({maxZoom:source.maxZoom||19})});break;case"TileTMS":source.url&&source.tileGrid||$log.error("[AngularJS - Openlayers] - TileTMS Layer needs valid url and tileGrid properties"),oSource=new ol.source.TileImage({url:source.url,maxExtent:source.maxExtent,attributions:createAttribution(source),tileGrid:new ol.tilegrid.TileGrid({origin:source.tileGrid.origin,resolutions:source.tileGrid.resolutions}),tileUrlFunction:function(tileCoord){var z=tileCoord[0],x=tileCoord[1],y=tileCoord[2];if(0>x||0>y)return"";var url=source.url+z+"/"+x+"/"+y+".png";return url}});break;case"TileImage":oSource=new ol.source.TileImage({url:source.url,attributions:createAttribution(source),tileGrid:new ol.tilegrid.TileGrid({origin:source.tileGrid.origin,resolutions:source.tileGrid.resolutions}),tileUrlFunction:function(tileCoord){var z=tileCoord[0],x=tileCoord[1],y=-tileCoord[2]-1,url=source.url.replace("{z}",z.toString()).replace("{x}",x.toString()).replace("{y}",y.toString());return url}});break;case"KML":var extractStyles=source.extractStyles||!1;oSource=new ol.source.Vector({url:source.url,format:new ol.format.KML,radius:source.radius,extractStyles:extractStyles});break;case"Stamen":if(!source.layer||!isValidStamenLayer(source.layer))return void $log.error("[AngularJS - Openlayers] - You need a valid Stamen layer.");oSource=new ol.source.Stamen({layer:source.layer});break;case"ImageStatic":if(!source.url||!angular.isArray(source.imageSize)||2!==source.imageSize.length)return void $log.error("[AngularJS - Openlayers] - You need a image URL to create a ImageStatic layer.");var imageProjection;imageProjection=source.hasOwnProperty("projection")?new ol.proj.get(source.projection):projection;var imageExtent;imageExtent=source.hasOwnProperty("extent")&&source.hasOwnProperty("extentProjection")?ol.proj.transformExtent(source.extent,source.extentProjection,projection.b):projection.getExtent(),oSource=new ol.source.ImageStatic({url:source.url,attributions:createAttribution(source),imageSize:source.imageSize,projection:imageProjection,imageExtent:imageExtent,imageLoadFunction:source.imageLoadFunction});break;case"XYZ":source.url||source.tileUrlFunction||$log.error("[AngularJS - Openlayers] - XYZ Layer needs valid url or tileUrlFunction properties"),oSource=new ol.source.XYZ({url:source.url,attributions:createAttribution(source),minZoom:source.minZoom,maxZoom:source.maxZoom,projection:source.projection,tileUrlFunction:source.tileUrlFunction});break;case"Zoomify":source.url&&angular.isArray(source.imageSize)&&2===source.imageSize.length||$log.error("[AngularJS - Openlayers] - Zoomify Layer needs valid url and imageSize properties"),oSource=new ol.source.Zoomify({url:source.url,size:source.imageSize})}return oSource||$log.warn('[AngularJS - Openlayers] - No source could be found for type "'+source.type+'"'),oSource},createAttribution=function(source){var attributions=[];return isDefined(source.attribution)&&attributions.unshift(new ol.Attribution({html:source.attribution})),attributions},createGroup=function(name){var olGroup=new ol.layer.Group;return olGroup.set("name",name),olGroup},getGroup=function(layers,name){var layer;return angular.forEach(layers,function(l){return l instanceof ol.layer.Group&&l.get("name")===name?void(layer=l):void 0}),layer},addLayerBeforeMarkers=function(layers,layer){for(var markersIndex,i=0;i<layers.getLength();i++){var l=layers.item(i);if(l.get("markers")){markersIndex=i;break}}if(isDefined(markersIndex)){var markers=layers.item(markersIndex);layer.index=markersIndex,layers.setAt(markersIndex,layer),markers.index=layers.getLength(),layers.push(markers)}else layer.index=layers.getLength(),layers.push(layer)},removeLayer=function(layers,index){layers.removeAt(index);for(var i=index;i<layers.getLength();i++){var l=layers.item(i);if(null===l){layers.insertAt(i,null);break}l.index=i}};return{isDefined:isDefined,isNumber:function(value){return angular.isNumber(value)},createView:function(view){var projection=createProjection(view),viewConfig={projection:projection,maxZoom:view.maxZoom,minZoom:view.minZoom};return view.center&&(viewConfig.center=view.center),view.extent&&(viewConfig.extent=view.extent),view.zoom&&(viewConfig.zoom=view.zoom),view.resolutions&&(viewConfig.resolutions=view.resolutions),new ol.View(viewConfig)},isDefinedAndNotNull:isDefinedAndNotNull,isString:function(value){return angular.isString(value)},isArray:function(value){return angular.isArray(value)},isObject:function(value){return angular.isObject(value)},equals:function(o1,o2){return angular.equals(o1,o2)},isValidCenter:function(center){return angular.isDefined(center)&&("boolean"==typeof center.autodiscover||angular.isNumber(center.lat)&&angular.isNumber(center.lon)||angular.isArray(center.coord)&&2===center.coord.length&&angular.isNumber(center.coord[0])&&angular.isNumber(center.coord[1])||angular.isArray(center.bounds)&&4===center.bounds.length&&angular.isNumber(center.bounds[0])&&angular.isNumber(center.bounds[1])&&angular.isNumber(center.bounds[1])&&angular.isNumber(center.bounds[2]))},safeApply:function($scope,fn){var phase=$scope.$root.$$phase;"$apply"===phase||"$digest"===phase?$scope.$eval(fn):$scope.$apply(fn)},isSameCenterOnMap:function(center,map){var urlProj=center.projection||"EPSG:4326",urlCenter=[center.lon,center.lat],mapProj=map.getView().getProjection(),mapCenter=ol.proj.transform(map.getView().getCenter(),mapProj,urlProj),zoom=map.getView().getZoom();return mapCenter[1].toFixed(4)===urlCenter[1].toFixed(4)&&mapCenter[0].toFixed(4)===urlCenter[0].toFixed(4)&&zoom===center.zoom},setCenter:function(view,projection,newCenter,map){if(map&&view.getCenter()){var pan=ol.animation.pan({duration:150,source:view.getCenter()});map.beforeRender(pan)}if(newCenter.projection===projection)view.setCenter([newCenter.lon,newCenter.lat]);else{var coord=[newCenter.lon,newCenter.lat];view.setCenter(ol.proj.transform(coord,newCenter.projection,projection))}},setZoom:function(view,zoom,map){var z=ol.animation.zoom({duration:150,resolution:map.getView().getResolution()});map.beforeRender(z),view.setZoom(zoom)},isBoolean:function(value){return"boolean"==typeof value},createStyle:createStyle,setMapEvents:function(events,map,scope){if(isDefined(events)&&angular.isArray(events.map))for(var i in events.map){var event=events.map[i];setEvent(map,event,scope)}},setVectorLayerEvents:function(events,map,scope,layerName){isDefined(events)&&angular.isArray(events.layers)&&angular.forEach(events.layers,function(eventType){angular.element(map.getViewport()).on(eventType,function(evt){var pixel=map.getEventPixel(evt),feature=map.forEachFeatureAtPixel(pixel,function(feature,olLayer){return isDefinedAndNotNull(olLayer)&&olLayer.get("name")===layerName?feature:null});isDefinedAndNotNull(feature)&&scope.$emit("openlayers.layers."+layerName+"."+eventType,feature,evt)})})},setViewEvents:function(events,map,scope){if(isDefined(events)&&angular.isArray(events.view)){var view=map.getView();angular.forEach(events.view,function(eventType){view.on(eventType,function(event){scope.$emit("openlayers.view."+eventType,view,event)})})}},detectLayerType:detectLayerType,createLayer:function(layer,projection,name){var oLayer,type=detectLayerType(layer),oSource=createSource(layer.source,projection);if(oSource){"Vector"===type&&layer.clustering&&(oSource=new ol.source.Cluster({source:oSource,distance:layer.clusteringDistance}));var layerConfig={source:oSource};switch(isDefinedAndNotNull(layer.opacity)&&(layerConfig.opacity=layer.opacity),isDefinedAndNotNull(layer.visible)&&(layerConfig.visible=layer.visible),isDefinedAndNotNull(layer.extent)&&(layerConfig.extent=layer.extent),isDefinedAndNotNull(layer.zIndex)&&(layerConfig.zIndex=layer.zIndex),isDefinedAndNotNull(layer.minResolution)&&(layerConfig.minResolution=layer.minResolution),isDefinedAndNotNull(layer.maxResolution)&&(layerConfig.maxResolution=layer.maxResolution),type){case"Image":oLayer=new ol.layer.Image(layerConfig);break;case"Tile":oLayer=new ol.layer.Tile(layerConfig);break;case"Heatmap":oLayer=new ol.layer.Heatmap(layerConfig);break;case"Vector":oLayer=new ol.layer.Vector(layerConfig)}if(isDefined(name)?oLayer.set("name",name):isDefined(layer.name)&&oLayer.set("name",layer.name),isDefined(layer.customAttributes))for(var key in layer.customAttributes)oLayer.set(key,layer.customAttributes[key]);return oLayer}},createVectorLayer:function(){return new ol.layer.Vector({source:new ol.source.Vector})},notifyCenterUrlHashChanged:function(scope,center,search){if(center.centerUrlHash){var centerUrlHash=center.lat.toFixed(4)+":"+center.lon.toFixed(4)+":"+center.zoom;isDefined(search.c)&&search.c===centerUrlHash||scope.$emit("centerUrlHash",centerUrlHash)}},getControlClasses:getControlClasses,detectControls:function(controls){var actualControls={},controlClasses=getControlClasses();return controls.forEach(function(control){for(var i in controlClasses)control instanceof controlClasses[i]&&(actualControls[i]=control)}),actualControls},createFeature:function(data,viewProjection){var geometry;switch(data.type){case"LineString":geometry=new ol.geom.LineString(data.coords);break;case"Polygon":geometry=new ol.geom.Polygon(data.coords);break;default:geometry=isDefined(data.coord)&&"pixel"===data.projection?new ol.geom.Point(data.coord):new ol.geom.Point([data.lon,data.lat])}isDefined(data.projection)&&"pixel"!==data.projection&&(geometry=geometry.transform(data.projection,viewProjection));var feature=new ol.Feature({geometry:geometry});if(isDefined(data.style)){var style=createStyle(data.style);feature.setStyle(style)}return feature},addLayerBeforeMarkers:addLayerBeforeMarkers,getGroup:getGroup,addLayerToGroup:function(layers,layer,name){var groupLayer=getGroup(layers,name);isDefined(groupLayer)||(groupLayer=createGroup(name),addLayerBeforeMarkers(layers,groupLayer)),layer.set("group",name),addLayerBeforeMarkers(groupLayer.getLayers(),layer)},removeLayerFromGroup:function(layers,layer,name){var groupLayer=getGroup(layers,name);layer.set("group"),removeLayer(groupLayer.getLayers(),layer.index)},removeLayer:removeLayer,insertLayer:function(layers,index,layer){if(layers.getLength()<index){for(;layers.getLength()<index;){var nullLayer=new ol.layer.Image;nullLayer.index=layers.getLength(),layers.push(nullLayer)}layer.index=index,layers.push(layer)}else{layer.index=index,layers.insertAt(layer.index,layer);for(var i=index+1;i<layers.getLength();i++){var l=layers.item(i);if(null===l){layers.removeAt(i);break}l.index=i}}},createOverlay:function(element,pos){element.css("display","block");var ov=new ol.Overlay({position:pos,element:element,positioning:"center-left"});return ov}}}),angular.module("openlayers-directive").factory("olMapDefaults",function($q,olHelpers){var base64icon="data:image/png;base64,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",_getDefaults=function(){return{view:{projection:"EPSG:3857",minZoom:void 0,maxZoom:void 0,rotation:0,extent:void 0},center:{lat:0,lon:0,zoom:1,autodiscover:!1,bounds:[],centerUrlHash:!1,projection:"EPSG:4326"},styles:{path:{stroke:{color:"blue",width:8}},marker:{image:new ol.style.Icon({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",opacity:.9,src:base64icon})}},events:{map:[],markers:[],layers:[]},controls:{attribution:!0,rotate:!1,zoom:!0},interactions:{mouseWheelZoom:!1},renderer:"canvas"}},isDefined=olHelpers.isDefined,defaults={};return{getDefaults:function(scope){if(!isDefined(scope))for(var i in defaults)return defaults[i];return defaults[scope.$id]},setDefaults:function(scope){var userDefaults=scope.defaults,scopeId=scope.$id,newDefaults=_getDefaults();return isDefined(userDefaults)&&(isDefined(userDefaults.layers)&&(newDefaults.layers=angular.copy(userDefaults.layers)),isDefined(userDefaults.controls)&&(newDefaults.controls=angular.copy(userDefaults.controls)),isDefined(userDefaults.events)&&(newDefaults.events=angular.copy(userDefaults.events)),isDefined(userDefaults.interactions)&&(newDefaults.interactions=angular.copy(userDefaults.interactions)),isDefined(userDefaults.renderer)&&(newDefaults.renderer=userDefaults.renderer),isDefined(userDefaults.view)&&(newDefaults.view.maxZoom=userDefaults.view.maxZoom||newDefaults.view.maxZoom,newDefaults.view.minZoom=userDefaults.view.minZoom||newDefaults.view.minZoom,newDefaults.view.projection=userDefaults.view.projection||newDefaults.view.projection,newDefaults.view.extent=userDefaults.view.extent||newDefaults.view.extent,newDefaults.view.resolutions=userDefaults.view.resolutions||newDefaults.view.resolutions),isDefined(userDefaults.styles)&&(newDefaults.styles=angular.extend(newDefaults.styles,userDefaults.styles))),defaults[scopeId]=newDefaults,newDefaults}}});